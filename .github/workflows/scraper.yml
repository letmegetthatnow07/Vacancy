- name: Queue PDF jobs for OCR
  run: |
    python3 << 'PYTHON_SCRIPT'
    import json
    from pathlib import Path
    
    # Load scraped jobs
    jobs = []
    for line in open("tmp/candidates.jsonl"):
        if line.strip():
            jobs.append(json.loads(line))
    
    # Extract PDF jobs that need review
    pdf_jobs = [
        j for j in jobs 
        if j.get("flags", {}).get("needs_pdf_review") 
        and j.get("pdfLink")
    ]
    
    if pdf_jobs:
        # Create dispatch payload
        payload = {
            "event_type": "process-pdfs",
            "client_payload": {
                "pdfs": [
                    {
                        "url": j["pdfLink"],
                        "jobId": j["id"],
                        "title": j["title"],
                        "source": j["source"]
                    }
                    for j in pdf_jobs
                ],
                "mode": "auto"
            }
        }
        
        # Trigger OCR workflow
        import subprocess
        result = subprocess.run([
            "curl", "-X", "POST",
            "https://api.github.com/repos/YOUR_USER/YOUR_REPO/dispatches",
            "-H", "Accept: application/vnd.github.v3+raw+json",
            "-H", f"Authorization: token {os.environ['GITHUB_TOKEN']}",
            "-d", json.dumps(payload)
        ])
        
        print(f"Queued {len(pdf_jobs)} jobs for OCR processing")
    PYTHON_SCRIPT
